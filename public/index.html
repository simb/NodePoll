<html>

<head>
    <title>Node Polling</title>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.5.2/jquery.min.js"></script>
    <script type="text/javascript" src="/socket.io/socket.io.js"></script>
    <script type="text/javascript" src="/js/types.js"></script>
</head>
<body>

<h1>Node Polling</h1>
<h5 id="status">Connecting to node polling server...</h5>

<div id="empty">
    <h3>Waiting to receive a question.</h3>
</div>

<div id="poll">
    <h3></h3>
    <ol></ol>
</div>

<div id="results">
    <h3>Poll Results:</h3>
    <ol></ol>
</div>

<script type="text/javascript">
    (function ($, undefined) {
        var socket;

        $(function () {
            $('#poll, #results').hide();
            
            socket = new io.Socket(document.location.hostname, document.location.port);
            socket.connect();
            socket.on('connect', function() {
                $('#status').text("Connected to Node Polling server! Waiting for a question.");
            });
            socket.on('message', function(msg) {
                if (msg.type === MESSAGE_TYPE_QUESTION) {
                    $('#poll h3').text(msg.question);

                    var opts = $('#poll ol').html('');
                    for (var i=0; i < msg.options.length; i++) {
                        opts.append('<li><a href="#">' + msg.options[i] + '</a></li>');
                    }

                    $('#empty, #results').hide();
                    $('#poll').show();

                } else if (msg.type === MESSAGE_TYPE_RESULTS) {
                    var opts = $('#results ol').html('');
                    for ( var o in msg.options) {
                        opts.append('<li>' + o + ': ' + msg.options[o] + '</li>')
                    }
                }
            });
            socket.on('disconnect', function() {
                $('#status').text("Disconnected from Node Polling server, refresh to try reconnecting.");
            });

            $('#poll ol li a').live('click', function () {
                var a = $(this).text();
                socket.send({
                    'type': MESSAGE_TYPE_VOTE,
                    'answer': a
                });

                $('#poll').hide();
                $('#results').show();
            });
        });

    })(jQuery);
</script>

</body>
</html>